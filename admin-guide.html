<html>
<head>
<title>Vac site admin guide</title>
</head>
<body>

<h1>Vac Site Admin Guide</h1>

<h2>Quick start</h2>

<p>
By following this quick start recipe you can verify that your installation 
will work with Vac and see it creating and destroying virtual machines. You
will almost certainly want to start again from scratch by following the
step-by-step part of the Admin Guide so don't invest a lot of time here.
If you're already familiar with VMs, you could just skip straight there.

<p>
To follow the quick start, you need an x86_64 Intel or AMD machine 
with hardware virtualization (Intel VT-x or AMD-V) enabled in its BIOS; and
the machine needs to be installed with a version of Scientific Linux 6, 
with libvirt installed and enabled. (In particular, the packages
libvirt, libvirt-client, libvirt-python, qemu-kvm, qemu-kvm-tools, and then
run &quot;service libvirtd restart&quot; to make sure libvirtd daemon is
running.)

<p>
Install the vac RPM, and download a recent compressed kvm-style CernVM batch 
image from the <a href="http://cernvm.cern.ch/portal/downloads">CernVM 
downloads page</a> to /tmp. Use zcat to extract the image itself to a
file in /tmp. 
It will be a large file: more than 9GB, although it's very sparse.

<p>
Copy the file /var/lib/vac/doc/testkvm.xml to /tmp as well, and edit the
&quot;source file=&quot; path and filename to point to your CernVM image.

<p>
At the command line, excecute
<pre>
virsh create --console testkvm.xml
</pre>
You should see the familiar Linux boot messages and eventually a login
prompt as the virtual machine boots using the CernVM image file as its root
filesystem. If all this doesn't happen, then something is wrong with your
installation or hardward virtualization isn't enabled. Please check the
libvirt documentation to try to identify where the problem is.

<p>
To get out of the login prompt, just press Ctrl and ] and then use the
command 
<pre>
virsh destroy testkvm
</pre>
to kill the VM. We're now ready to set up Vac itself.

<p>
To create another pristine disk image, use zcat again to make another copy
in /tmp and then use cp to make a sparse copy of this image in Vac's
area (you may need to change the exact version numbers in these file names):
<pre>
cd /tmp
zcat cernvm-batch-node-2.6.0-4-1-x86_64.hdd.gz >cernvm-batch-node-2.6.0-4-1-x86_64.hdd
cp --sparse=always cernvm-batch-node-2.6.0-4-1-x86_64.hdd /var/lib/vac/images
</pre>
We do this because zcat (and gunzip) won't create sparse files, but cp can
and they are much quicker to read and copy around.

<p>
Now you need to create the /etc/vac.conf configuration file. Copy
/var/lib/vac/doc/example.vac.conf to /etc/vac.conf and read through its
comments.



<h2>Step-by-step</h2>
- Xen vs kvm
- CERNVM images
- DNS, IP, MAC
- logical volumes 
- installation: tar vs RPM
- configuration of factory and virtualmachines
- setting up vmtypes

<h2>Using vac command</h2>

<h2>Setting up Nagios</h2>

<h2>Setting up APEL</h2>

<h2>Tuning backoff</h2>

<h2>Troubleshooting</h2>

</body>
</html>
